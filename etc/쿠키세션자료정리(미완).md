[chrome-extension://chphlpgkkbolifaimnlloiipkdnihall/onetab.html](chrome-extension://chphlpgkkbolifaimnlloiipkdnihall/onetab.html)



# JWT

```
1. JWTë€
	- ì„œë²„ ê¸°ë°˜ ì¸ì¦ 
	- í† í° ê¸°ë°˜ ì¸ì¦
    	stateless
    	REST ful
2. ì–´ë””ì— ì €ì¥í•  ê²ƒì¸ê°€
3. ë³´ì•ˆ ë¬¸ì œ
4. ë” ì½ì„ ê±°ë¦¬
```

JWT ì´í•´ ë° ì ìš© https://backend-intro.vlpt.us/4/



JWT(Json Web Token)ì€ í† í° ê¸°ë°˜ ì¸ì¦ ë°©ì‹ìœ¼ë¡œ, í´ë¼ì´ì–¸íŠ¸ì˜ ì„¸ì…˜ ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ í•„ìš”í•œ ì •ë³´ë¥¼ í† í° bodyì— ì €ì¥í•´ í´ë¼ì´ì–¸íŠ¸ê°€ ê°€ì§€ê³  ìˆê³  ê·¸ê²ƒì„ ì¦ëª…ì„œì²˜ëŸ¼ ì‚¬ìš©í•œë‹¤.



ìµœê·¼ ë“¤ì–´ IT ì¸í”„ë¼ êµ¬ì„±ì— ë§ì€ ë³€í™”ê°€ ìƒê²¼ë‹¤. ì›¹ ê¸°ë°˜ì˜ ì„œë¹„ìŠ¤ë“¤ì€ ì›¹ê³¼ ì•±ì„ í•¨ê»˜ ì„œë¹„ìŠ¤í•˜ëŠ” ê²ƒì„ ë„˜ì–´ â€˜Mobile Firstâ€™ ì•±ì´ ë¨¼ì €ë¼ëŠ” ì¸ì‹ê¹Œì§€ ìƒê²¨ë‚¬ë‹¤.
ë˜í•œ, AWS, Azure ì™€ ê°™ì€ [IaaS](https://ko.wikipedia.org/wiki/IaaS) í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ê°€ ëŒ€ì¤‘í™” ë˜ë©´ì„œ ê³ ì‚¬ì–‘ ë‹¨ì¼ ì„œë²„ ì•„í‚¤í…ì³ì—ì„œ ì¤‘-ì €ì‚¬ì–‘ ë‹¤ì¤‘ ì„œë²„ ì•„í‚¤í…ì³ë¡œ ë³€í™”í•˜ê³  ìˆë‹¤.
ì´ëŸ¬í•œ ìƒí™©ì—ì„œ ë” ì´ìƒ ì¿ í‚¤-ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ ì•„í‚¤í…ì³ëŠ” í˜„ì¬ì˜ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ì§€ ëª»í•˜ê³  ìˆë‹¤.

í˜„ì¬ì˜ ìš”êµ¬ ì‚¬í•­ì„ ê·¸ë‚˜ë§ˆ ì¶©ì¡±ì‹œí‚¤ëŠ” Web Token ê¸°ë°˜ **JWT**ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê³  `Web Token`ì´ ë‚˜íƒ€ë‚œ ë°°ê²½ê³¼ ì¥ë‹¨ì 



https://sanghaklee.tistory.com/47

https://jwt.io/introduction/

handbook ë„ ìˆë‹¤ https://auth0.com/resources/ebooks/jwt-handbook

- ì´ë²ˆ í”Œì ì˜ ëª©í‘œ: JWTë¥¼ ì´í•´í•œë‹¤, êµ¬í˜„í•œë‹¤, set-cookie í•œë‹¤.



## ê¸°ë³¸ êµ¬ì„±

```
xxxxx.yyyyy.zzzzz
```

3ê°€ì§€ë¡œ ë‚˜ëˆ ì§„ë‹¤.

- **Header** (`xxxxx`)â€” JWTì¸ í† í°ì˜ ìœ í˜•ì´ë‚˜ HMAC SHA256 ë˜ëŠ” RSAì™€ ê°™ì´ ì‚¬ìš©ë˜ëŠ” í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ì´ ë¬´ì—‡ìœ¼ë¡œ ì‚¬ìš©í–ˆëŠ”ì§€ ë“± ì •ë³´ê°€ ë‹´ê¸´ë‹¤. Base64Urlë¡œ ì¸ì½”ë”©ë˜ì–´ìˆë‹¤.

- **Payload** (`yyyyy`)â€” í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ ì •ë³´ë‚˜, meta Dataê°™ì€ ë‚´ìš©ì´ ë“¤ì–´ìˆê³ , Base64Urlë¡œ ì¸ì½”ë”©ë˜ì–´ìˆë‹¤.

- **Signature** (`zzzzz`)â€” headerì—ì„œ ì§€ì •í•œ ì•Œê³ ë¦¬ì¦˜ê³¼ secret í‚¤, ì„œëª…ìœ¼ë¡œ payloadì™€ headerë¥¼ ë‹´ëŠ”ë‹¤.

- ## payload ë‚´ìš©

  JWTëŠ” ë‚´ìš©ì„ í•´ë…í•´ ë³¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¤‘ìš”í•œ ë°ì´í„°ë¥¼ í¬í•¨í•´ì„  ì•ˆëœë‹¤.

  https://jwt.io/ ì´ê³³ì—ì„œ jwtë¥¼ í•´ë…í•  ìˆ˜ ìˆë‹¤.



## ê¸°ë³¸ ì¸ì¦ ê³¼ì •

ê°„ë‹¨í•œ JWT ì¸ì¦ ì²˜ë¦¬ ê³¼ì •ì´ë‹¤.

1. í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œê·¸ì¸ì„ í•˜ë©´, ì„œë²„ë¡œë¶€í„° access í† í°ì„ ë¶€ì—¬ë°›ëŠ”ë‹¤.
2. ì´í›„ í´ë¼ì´ì–¸íŠ¸ê°€ ëª¨ë“  api ìš”ì²­ì„ í•  ë•Œ access í† í°ì„ í¬í•¨ì‹œí‚¨ë‹¤.
3. ì„œë²„ëŠ” access í† í°ì„ í•´ë…í•´ í™•ì¸í•˜ê³  ê²€ì¦ë˜ë©´ í•´ë‹¹ api ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œë‹¤.
4. ê¸°í•œì´ ë§Œë£Œë˜ì—ˆìœ¼ë©´ access í† í°ì„ ì§€ì›Œì£¼ê³  ì¬ë¡œê·¸ì¸ì„ í•˜ê²Œ í•œë‹¤.

### ë¬¸ì œì 

- í´ë¼ì´ì–¸íŠ¸ê°€ ê³„ì† ì‹œìŠ¤í…œì„ ì´ìš©í•˜ë‹¤ê°€ access í† í° ê¸°í•œì´ ë§Œë£Œëœë‹¤ë©´ ì‚¬ìš©ì¤‘ì— ê°‘ìê¸° ë¡œê·¸ì¸ì„ í•˜ë¼ê³  í•  ê²ƒì´ë‹¤.
- ìˆ˜ëª…ì´ ì§§ë‹¤ë©´ ë§Œë£Œë ë•Œë§ˆë‹¤ ë¡œê·¸ì¸ í•´ì£¼ì–´ì•¼ í•œë‹¤.
- ìˆ˜ëª…ì´ ê¸¸ë©´ í•´ì»¤ì—ê²Œ í•´ë…ë˜ì–´ ì‚¬ìš©ë  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§„ë‹¤.

## Refresh Token

access í† í°ì´ ë§Œë£Œë˜ì—ˆì„ ë•Œ, Refresh í† í°ìœ¼ë¡œ ì„œë²™ìƒˆë¡œìš´ access í† í°ì„ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆë‹¤.

- Refresh Tokenìœ¼ë¡œ access í† í°ì´ ë§Œë£Œë˜ë©´ ì•Œì•„ì„œ ê°±ì‹ í•œë‹¤.



JWTëŠ” ë§ì€ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì§€ì›í•˜ê³  ìˆìœ¼ë©°, Node.jsì—ì„œë„ **jsonwebtoken**ì´ë¼ëŠ” ëª¨ë“ˆë¡œ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.

ì´ì œ ì´ ëª¨ë“ˆì„ ì´ìš©í•´ì„œ JWTë¥¼ ì´ìš©í•œ ì‚¬ìš©ì ì¸ì¦ì„ êµ¬í˜„í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

( jsonwebtokenì— ëŒ€í•œ ê¹ƒí—™ ë¬¸ì„œëŠ” [ì—¬ê¸°](https://github.com/auth0/node-jsonwebtoken)ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš” ! )



- ì •ë³´ê°€ ë‹´ê¸´ ë°ì´í„°( JSON ê°ì²´ )ë¥¼ ì•”í˜¸í™” í•˜ì—¬, HTTP í—¤ë”ì— ì¶”ê°€ ì‹œí‚¨ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

- - ë³´ì•ˆì„± ì¦ê°€

- ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë°ì´í„°ê°€ JWTì•ˆì— ëª¨ë‘ ë‹´ê²¨ìˆìŠµë‹ˆë‹¤.

- - OAuth ì²˜ëŸ¼ ì¸ì¦ ì„œë²„ì—ì„œ í† í°ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì„ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

    Resource ì„œë²„ê°€ ë§ì•„ì§€ë©´ **Auth ì„œë²„ê°€ ë„ˆë¬´ ë°”ë¹ ì§‘ë‹ˆë‹¤.** ê°ê°ì˜ Resource ì„œë²„ê°€ Tokenì˜ ìœ íš¨ì„±, ê¶Œí•œ í™•ì¸ì„ Auth ì„œë²„ì— ìš”ì²­í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. (*ì´ë¯¸ ì¸ì¦í–ˆëŠ”ë°â€¦. ë‚­ë¹„â€¦*)

    ê·¸ë˜ì„œ Resource ì„œë²„ê°€ ë§ì€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì—ì„œëŠ” **Tokenë§Œìœ¼ë¡œ ìœ íš¨ì„± & ê¶Œí•œ í™•ì¸ì´ ê°€ëŠ¥í•œ JWT**ê°€ í•„ìš”í•©ë‹ˆë‹¤.

    B. JWTì™€ í•¨ê»˜ë¼ë©´!

    JWTë¥¼ ì‚¬ìš©í•˜ë©´ Auth ì„œë²„ì— ë§¤ë²ˆ ìš”ì²­í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

    JWTì— ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, ê°œë³„ ì„œë¹„ìŠ¤ë“¤ì€ ìì²´ì ìœ¼ë¡œ Tokenì˜ ìœ íš¨ì„±, ê¶Œí•œ ì •ë³´ë¥¼ ì²´í¬í•œ í›„ ë°”ë¡œ Resourceë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ê³  JWTê°€ ë³´ì•ˆì— ì™„ë²½í•œ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.

ëˆ„êµ°ê°€ê°€ í† í°ì„ íƒˆì·¨í•œë‹¤ë©´, ê·¸ í† í°ì„ ì´ìš©í•˜ì—¬ ê¶Œí•œì„ ìˆ˜í–‰í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ í† í°ì„ ì„œë²„ì— ì €ì¥í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— **í† í°ì—** **ìœ íš¨ì‹œê°„**ì„ ì„¤ì •í•´ì•¼ í•˜ë©°, íƒˆì·¨ ë  ê°€ëŠ¥ì„±ì„ ì¤„ì´ê¸° ìœ„í•´ **ìœ íš¨ì‹œê°„ì„ ì§§ê²Œ í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.**



- ì•”í˜¸í™” ì—…ê·¸ë ˆì´ë“œ 
- ê³µì‹ì—ë„ ì¨ìˆë‹¤ JWTs can be signed using a secret (with the **HMAC** algorithm) or a public/private key pair using **RSA** or **ECDSA**.
  - HMAC
    - http://blog.jakeymvc.com/sso-hmac/
    
    - https://ohgyun.com/433
    
    - https://en.wikipedia.org/wiki/HMAC
    
    - Algorithm - JWT ìœ„ë³€ì¡°ë¥¼ ì•Œì•„ë‚´ëŠ” HMACì´ë€?  https://coding-start.tistory.com/157 
    
    - 
    
      - JWT ë³´ì•ˆ ê´€ë ¨ ì•ìœ¼ë¡œ ë” ê³µë¶€í•´ì•¼ í•˜ëŠ” ë‚´ìš©
        - meduim (@mjkim111)| JSON Web Token(JWT) ì •ë¦¬ https://medium.com/@mjkim111/json-web-token-jwt-%EC%A0%95%EB%A6%AC-abbc80570301
    
      



jwt ì“°ëŠ” ê·œì•½(?)

https://www.iana.org/assignments/jwt/jwt.xhtml

- nodejs jsonwebtoken https://github.com/auth0/node-jsonwebtoken
- https://www.npmjs.com/package/jsonwebtoken



#### Token

- velopert | [JWT] í† í°(Token) ê¸°ë°˜ ì¸ì¦ì— ëŒ€í•œ ì†Œê°œ https://velopert.com/2350
- okky | REST ì•„í‚¤í…ì³ì™€ JWT, OAuth, ê·¸ë¦¬ê³  SPA https://okky.kr/article/409195

 

#### ì•ˆì „

- Lazy Honey Ant | JWT í† í°ì€ ì–´ë””ì— ì €ì¥í•˜ëŠ”ê²Œ ì¢‹ì„ê¹Œ? http://lazyhoneyant.blogspot.com/2016/08/jwt.html

- stack overflow | RS256 vs HS256: What's the difference? https://stackoverflow.com/questions/39239051/rs256-vs-hs256-whats-the-difference

- diokun | ì•ˆì „í•œ JWT ì›¹ ì„œë¹„ìŠ¤ ì‚¬ìš©ì ì¸ì¦ êµ¬í˜„í•˜ê¸° https://diokun.wordpress.com/2017/04/07/%EC%95%88%EC%A0%84%ED%95%9C-jwt-%EC%9B%B9%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0/
- code-machina | JSON ì›¹ í† í° (JWT) ë³´ì•ˆ https://code-machina.github.io/2019/09/01/Security-On-JSON-Web-Token.html



JWTëŠ” ì•ˆì „í•œ HttpOnly ì¿ í‚¤ì— ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•´ì•¼ Cross-Site Scripting(XSS) ê³µê²©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¿ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ JWTë¥¼ ì „ì†¡í•œë‹¤ë©´, CSRF ë°©ì–´ê°€ ë¬´ì—‡ë³´ë‹¤ ì¤‘ìš”í•©ë‹ˆë‹¤. ì•…ì˜ì ì¸ ë‹¤ë¥¸ ë„ë©”ì¸ì— ì˜í•´ì„œ ì‚¬ìš©ìê°€ ì¸ì‹í•˜ì§€ ëª» í•˜ëŠ” ì‚¬ì´ì— ìš°ë¦¬ê°€ êµ¬ì¶•í•œ ì›¹ ì„œë²„ë¡œ ìš”ì²­ì´ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í† í°ì˜ ì „ì†¡ ë°©ì‹ìœ¼ë¡œ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ CSRFì— ëŒ€í•œ ëŒ€ë¹„ì±…ì„ ë°˜ë“œì‹œ ì¤€ë¹„ í•´ì•¼ í•©ë‹ˆë‹¤.

ê°•ë ¥í•œ í‚¤*key*ë¡œ í† í°ì„ ì„œëª…í•´ì•¼ í•˜ë©° í‚¤*key*ëŠ” ì¸ì¦ ì„œë¹„ìŠ¤ì—ì„œë§Œ ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤. í† í°ì„ ì‚¬ìš©í•´ì„œ ì‚¬ìš©ìë¥¼ ì¸ì¦í•  ë•Œë§ˆë‹¤ í•­ìƒ ë³´ì•ˆ í‚¤ë¡œ ì„œëª…ë˜ì–´ ìˆëŠ”ì§€ ê²€ì‚¬í•´ì•¼ í•©ë‹ˆë‹¤.

ë¯¼ê°í•œ ë°ì´í„°ëŠ” JWTë¡œ ì €ì¥í•˜ë©´ ì•ˆë©ë‹ˆë‹¤. 

`JWT Inspector`ëŠ” í¬ë¡¬ ë¸Œë¼ìš°ì €ì˜ ì˜¤í”ˆì†ŒìŠ¤ ìµìŠ¤í…ì…˜ìœ¼ë¡œ ê°œë°œìê°€ JWTë¥¼ ë¸Œë¼ìš°ì € ë‚´ì—ì„œ ë””ë²„ê·¸í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.



- ê°“ê°“  íŠœí† ë¦¬ì–¼ : https://scotch.io/tutorials/authenticate-a-node-es6-api-with-json-web-tokens





claim ê¸°ë°˜ í† í°ì˜ ê°œë… https://bcho.tistory.com/999





RS256 & HS256





JSON (application/json)

x-www-form-urlencoded





ê¸°ì¡´ì˜ Access Tokenì˜ ìœ íš¨ê¸°ê°„ì„ ì§§ê²Œ í•˜ê³  Refresh Tokenì´ë¼ëŠ” ìƒˆë¡œìš´ í† í°ì„ ë°œê¸‰í•©ë‹ˆë‹¤. ê·¸ë ‡ê²Œ ë˜ë©´ Access Tokenì„ íƒˆì·¨ë‹¹í•´ë„ ìƒëŒ€ì ìœ¼ë¡œ í”¼í•´ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‹¤ìŒ í¬ìŠ¤íŒ…ì— ë‚˜ì˜¬ Oauth2ì— ë” ìì„¸íˆ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.





í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ì— ì¸ì¦ ìš”ì²­í•œë‹¤.

ì¸ì¦ì´ ì„±ê³µëœë‹¤ë©´ ì„œë²„ì—ì„œ ì‚¬ìš©í•  í´ë ˆì„ì„ í¬í•¨í•œ JWTë¥¼ ìƒì„±í•´ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë„˜ê²¨ì¤€ë‹¤.
ì¼ë°˜ì ìœ¼ë¡œ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥ë˜ì§€ë§Œ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.

ê·¸ë¦¬ê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¸ì¦ì´ í•„ìš”í•œ ì–´ë– í•œ ìš”ì²­ì„ í•  ê²½ìš° ìš”ì²­ í—¤ë”ì— ì¶”ê°€í•´ì¤€ë‹¤.

ì„œë²„ëŠ” ìš”ì²­ í—¤ë”ì—ì„œ í† í° ê°’ì„ ë””ì½”ë”©í•´ í•„ìš”í•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë©° ê·¸ì— ë”°ë¥¸ ìš”ì²­ ì‘ë‹µì„ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ë‚´ì¤€ë‹¤.



ì„œë²„ì—ì„œ í† í°ì´ ìœ íš¨í•˜ë‹¤ê³  íŒë‹¨í•˜ë©´ í´ë ˆì„ë“¤ì„ ë””ì½”ë”©í•´ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
ì„œë²„ì˜ ë©”ëª¨ë¦¬ì™€ ê°™ì´ ë‹¤ë¥¸ ê³³ì— ë”°ë¡œ ê´€ë¦¬ë¥¼ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ëœ»ì´ë‹¤.

ë”°ë¼ì„œ `Stateless`í•œ ì„œë²„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆê²Œ ëœë‹¤.
ê·¸ëŸ¬ë¯€ë¡œ ì„œë²„ì˜ í™•ì¥ì´ ìš©ì´í•˜ê³  ìš”ì²­ ë„ë©”ì¸ì— ê´€í•´ ë¬¸ì œê°€ ë˜ì§€ ì•Šì•„ `CORS`ë¬¸ì œë¥¼ ìƒê°í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.



í•˜ì§€ë§Œ í´ë ˆì„ì…‹ì´ ì¦ê°€í•˜ë©´ ìì—°ìŠ¤ë ˆ í† í°ì˜ ê¸¸ì´ê°€ ì¦ê°€í•˜ê²Œ ë˜ëŠ”ë° ìš”ì²­ í—¤ë”ì— í† í°ì„ ì‚½ì…í•˜ëŠ” ë°©ì‹ì´ë¯€ë¡œ ê³¼í•œ ì˜¤ë²„í—¤ë“œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.



- p.404



```django

# REST_framework ì„¤ì •
REST_FRAMEWORK = {
		# ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” í´ë˜ìŠ¤
    'DEFAULT_PERMISSION_CLASSES': (
        'rest_framework.permissions.IsAuthenticated',
    ),
		# ì¸ì¦ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” í´ë˜ìŠ¤
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework_jwt.authentication.JSONWebTokenAuthentication',
        'rest_framework.authentication.SessionAuthentication',
        'rest_framework.authentication.BasicAuthentication',
    ),
}

# JWT ì„¤ì •
JWT_AUTH = {
		# JWTë¥¼ encryptí•¨.ì ˆëŒ€ ì™¸ë¶€ ë…¸ì¶œ ê¸ˆì§€, defaultëŠ” settings.SECRET_KEY
    'JWT_SECRET_KEY': SECRET_KEY,
		# í† í° í•´ì‹± ì•Œê³ ë¦¬ì¦˜(HMAC using SHA-256 hash algorithm (default)
    'JWT_ALGORITHM': 'HS256',
		# í† í° ê°±ì‹  í—ˆìš© ì—¬ë¶€
    'JWT_ALLOW_REFRESH': True,
		# 1ì£¼ì¼ê°„ ìœ íš¨í•œ í† í° - defaultëŠ” 5ë¶„ (import datetime)
    'JWT_EXPIRATION_DELTA': datetime.timedelta(days=7),
		# 28ì¼ ë§ˆë‹¤ í† í°ì´ ê°±ì‹ (ìœ íš¨ ê¸°ê°„ ì—°ì¥ì‹œ)
    'JWT_REFRESH_EXPIRATION_DELTA': datetime.timedelta(days=28),
}

```

```
from rest_framework_jwt.views import obtain_jwt_token


urlpatterns = [
    path('admin/', admin.site.urls),

    path('api-token-auth/', obtain_jwt_token),

    path('api/v1/movies/', include('movies.urls')),
    path('api/v1/users/', include('accounts.urls')),
]

```



#### JWT ì˜ ë‹¨ì  & ë„ì…ì‹œ ê³ ë ¤ì‚¬í•­

- `Self-contained` : í† í° ìì²´ì— ì •ë³´ê°€ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì€ ì–‘ë‚ ì˜ ê²€ì´ ë ìˆ˜ ìˆë‹¤.
  - `í† í° ê¸¸ì´` : í† í° ìì²´ payload ì— Claim setì„ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ì •ë³´ê°€ ë§ì•„ì§ˆìˆ˜ë¡ í† í°ì˜ ê¸¸ì´ê°€ ëŠ˜ì–´ë‚˜ ë„¤íŠ¸ì›Œí¬ì— ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ ìˆë‹¤.
  - `payload ì•”í˜¸í™”` : payload ìì²´ëŠ” ì•”í˜¸í™” ë˜ì§€ ì•Šê³  base64ë¡œ ì¸ì½”ë”©í•œ ë°ì´í„°ë‹¤.
    ì¤‘ê°„ì— payloadë¥¼ íƒˆì·¨í•˜ë©´ ë””ì½”ë”©ì„ í†µí•´ í…Œì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.
    [JWE](https://tools.ietf.org/html/rfc7516) ë¥¼ í†µí•´ ì•”í˜¸í•˜í•˜ê±°ë‚˜, payloadì— ì¤‘ìš” ë°ì´í„°ë¥¼ ë„£ì§€ ì•Šì•„ì•¼ í•œë‹¤.
- `Stateless` : ë¬´ìƒíƒœì„±ì´ ë•Œë¡  ë¶ˆí¸í•  ìˆ˜ ìˆë‹¤. í† í°ì€ í•œë²ˆ ë§Œë“¤ë©´ ì„œë²„ì—ì„œ ì œì–´ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
  í† í°ì„ ì„ì˜ë¡œ ì‚­ì œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ê¸° ë•Œë¬¸ì— í† í° ë§Œë£Œì‹œê°„ì„ ê¼­ ë„£ì–´ì£¼ëŠ”ê²Œ ì¢‹ë‹¤.
- `tore Token` : í† í°ì€ í´ë¼ì´ì–¸íŠ¸ sideì—ì„œ ê´€ë¦¬í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— í† í°ì„ ì €ì¥í•´ì•¼í•œë‹¤.



### Conclusion

HTTP, REST API ì˜ ê³µí†µì ì¸ íŠ¹ì§•ì€ `Stateless`(ë¬´ìƒíƒœ)ë¥¼ ì§€í–¥í•œë‹¤ëŠ” ê²ƒì´ë‹¤.
`Stateful`, ì¦‰ ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” ì„œë²„ëŠ” ë§ì€ [Side-effect](https://en.wikipedia.org/wiki/Side_effect_(computer_science))ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.
ë˜í•œ, ì„œë¡ ì— ë§í–ˆë“¯ì´ í˜„ì¬ì˜ IT ì¸í”„ë¼ êµ¬ì¡°ëŠ” ìœ ì—°í•œ í™•ì¥ ê°€ëŠ¥ì„±ì´ ìˆì–´ì•¼ í•˜ëŠ”ë° ê¸°ì¡´ì˜ ì¿ í‚¤-ì„¸ì…˜ ê¸°ë°˜ì˜ ì¸ì¦ì„ ì‚¬ìš©í•˜ë©´ í™•ì¥ ê°€ëŠ¥í•œ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•˜ê¸° í˜ë“¤ë‹¤.
ê¸°ì¡´ì˜ ë¡œê·¸ì¸ / ì¸ì¦ì„ ëª¨ë‘ Web Token ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, ì•ìœ¼ë¡œ ë§Œë“¤ê²Œ ë  ì„œë¹„ìŠ¤ íŠ¹íˆ [RESTful](https://en.wikipedia.org/wiki/Representational_state_transfer)í•œ APIì˜ ì¸ì¦ì—ëŠ” JWTë¥¼ ì‚¬ìš©í•´ë³´ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒì´ë¼ ìƒê°í•œë‹¤.



https://sanghaklee.tistory.com/47



#### REST API

[REST API](https://www.a-mean-blog.com/ko/blog/í† ë§‰ê¸€/_/RESTì™€-RESTful-API)ì—ì„œ ë¡œê·¸ì¸ì€ ì¼ë°˜ì ì¸ ë¡œê·¸ì¸ê³¼ ê·¸ ë°©ì‹ì´ ë‹¤ë¦…ë‹ˆë‹¤.

ì¼ë°˜ì ì¸ ë¡œê·¸ì¸ì€ ì„œë²„ì˜ sessionì„ í†µí•´ ì´ë£¨ì–´ì§€ëŠ”ë°, ì„œë²„ëŠ” ì ‘ì†ì¤‘ì¸ í´ë¼ì´ì–¸íŠ¸ë“¤ì„ ì´ sessionì„ í†µí•´ ê´€ë¦¬í•©ë‹ˆë‹¤. ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ë©´ sessionì— í•´ë‹¹ í´ë¼ì´ì–¸íŠ¸ê°€ ê¸°ë¡ë˜ê³  ë¡œê·¸ì¸ì„ í•˜ê²Œ ë˜ë©´ í•´ë‹¹ í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œê·¸ì¸í•œ ê²ƒì„ ì €ì¥í•˜ê²Œ ë©ë‹ˆë‹¤. ì´í›„ í•´ë‹¹ í´ë¼ì´ì–¸íŠ¸ëŠ” ë¡œê·¸ì¸ì´ ìš”êµ¬ë˜ëŠ” ì •ë³´ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ì´ ë°©ì‹ì€ ì ‘ì†ììˆ˜ê°€ ëŠ˜ì–´ë‚˜ë©´ ì„œë²„ì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•˜ê²Œ ë˜ê³  ì„±ëŠ¥ì— ì˜í–¥ì„ ë¯¸ì¹˜ê²Œ ë©ë‹ˆë‹¤. (ì„œë²„ë¥¼ ì¦ì„¤í•˜ê³  sessionê´€ë¦¬ìš© ì„œë²„ë¥¼ ë¶„ë¦¬í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ í†µí•´ ì´ë¥¼ ê·¹ë³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)

[REST API](https://www.a-mean-blog.com/ko/blog/í† ë§‰ê¸€/_/RESTì™€-RESTful-API)ì—ì„œëŠ” ì„œë²„ê°€ sessionì„ ê°€ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¬¼ë¡  REST APIì„œë²„ì—ë„ sessionì„ ì¶”ê°€í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ ì´ëŠ” RESTê°€ ì§€í–¥í•˜ëŠ” ë°”ê°€ ì•„ë‹™ë‹ˆë‹¤. ëŒ€ì‹  **REST APIëŠ” í† í°(token) ì¸ì¦ë°©ì‹**ì„ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.

ë¡œê·¸ì¸ APIë¡œ ì•„ì´ë””ì™€ íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•¨ì´ í™•ì¸ë˜ë©´ ì„œë²„ëŠ” í† í°ì„ ë°œí–‰í•˜ê³ , ë¡œê·¸ì¸ í›„ ì´ìš©ê°€ëŠ¥í•œ APIë“¤ì—ëŠ” ìœ íš¨í•œ í† í°ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ì´ë•Œ í† í°ì€ ë‹¹ì—°í•˜ê²Œë„ ìœ„ì¡°í•˜ê¸°ê°€ ì–´ë ¤ì›Œì•¼ í•˜ë©° ì‚¬ìš©ìë¥¼ ì¸ì‹í•  ìˆ˜ ìˆëŠ” ì •ë³´ê°€ ë“¤ì–´ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ í¬ìŠ¤íŒ…ì—ì„œëŠ” JWT(JSON Web Token, [http://jwt.io](http://jwt.io/)) packageë¥¼ ì‚¬ìš©í•´ì„œ í† í°ì„ ìƒì„±í•˜ê³  í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤. 





- Stack overflow | Why are Refresh Tokens considered insecure for an SPA? https://stackoverflow.com/questions/49290819/why-are-refresh-tokens-considered-insecure-for-an-spa

- Auth0 Docs | Which OAuth 2.0 Flow Should I Use? https://auth0.com/docs/api-auth/which-oauth-flow-to-use#is-the-client-a-native-app-or-a-spa-



passport-jwt ìˆìŠµë‹ˆë‹¤. https://parkseokje.github.io/2017/03/07/jwt/

passport-kakao https://www.npmjs.com/package/passport-kakao

+ https://cheese10yun.github.io/passport-thirdpart-loginl/
+ naver api ì¸ì¦ ì¤€ë¹„ https://developers.worksmobile.com/kr/document/1002002?lang=ko



ë‚˜ëŠ” passport-local ì“°ë©´ì„œ jwt ì“°ê³  ì‹¶ë‹¤

- medium | Learn using JWT with Passport authentication https://medium.com/front-end-weekly/learn-using-jwt-with-passport-authentication-9761539c4314 ì¤‘ê°„ì—**{session: false}**  ë¶€ë¶„ì´ í•µì‹¬
- Stack Hoarder | Passport.js + JWT Token ë¡œê·¸ì¸ ì¸ì¦ êµ¬í˜„ [https://stackhoarder.com/2019/07/17/node-js-passport-js-jwt-token-%EC%9D%B4%EC%9A%A9%ED%95%B4-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EA%B5%AC%ED%98%84/](https://stackhoarder.com/2019/07/17/node-js-passport-js-jwt-token-ì´ìš©í•´-ë¡œê·¸ì¸-êµ¬í˜„/) ìœ„ì™€ ìœ ì‚¬í•œ ì½”ë“œ í•œê¸€ ë²„ì „ 





**secretOrPrivateKey**: hash ìƒì„±ì— ì‚¬ìš©ë˜ëŠ” keyë¬¸ìì—´ì…ë‹ˆë‹¤. í•´ë…ì‹œ ìƒì„±ì— ì‚¬ìš©ëœ ê°™ì€ ë¬¸ìì—´ì„ ì‚¬ìš©í•´ì•¼ í•´ë…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.









## oauth ëŠ” ë­ì•¼?

## OAuth

OAuth 2.0ì€ ì¸ì¦*authentication*ê³¼ í—ˆê°€*authorization*ë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ì™€ ìƒí˜¸ ì—°ë™ì„ í•˜ê¸° ìœ„í•œ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ìˆ˜ë§ì€ ëª¨ë°”ì¼ ë° ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í­ ë„“ê²Œ ë„ì…ë˜ì—ˆìŠµë‹ˆë‹¤. OAuth 2.0ì—ì„œ í† í°ì˜ í˜•íƒœë¥¼ ê·œì •í•˜ê³  ìˆì§€ëŠ” ì•Šì§€ë§Œ JWTê°€ ì‚¬ì‹¤ìƒì˜ ë¹ ë¥´ê²Œ ì‚°ì—… í‘œì¤€ì´ ë˜ì–´ ê°€ê³  ìˆìŠµë‹ˆë‹¤.

OAuthì˜ êµ¬ì¡°ì—ì„œëŠ” ë‘ ê°€ì§€ í† í° íƒ€ì…(ì•¡ì„¸ìŠ¤*access* í† í°, ë¦¬í”„ë ˆì‰¬*refresh* í† í°)ì´ ìˆìŠµë‹ˆë‹¤. ìµœì´ˆì˜ ì¸ì¦ì—ì„œ ì‚¬ìš©ìì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ ë‘ ê°€ì§€ í† í°ì„ ë°œê¸‰ ë°›ìŠµë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ í† í°ì€ ìƒëŒ€ì ìœ¼ë¡œ ì§§ì€ ì‹œê°„ ì´í›„ì— ë¬´íš¨í™”*expire*ë˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ìµœì´ˆì˜ ì•¡ì„¸ìŠ¤ í† í°ì´ ë¬´íš¨í™”ë˜ë©´ ë¦¬í”„ë ˆì‰¬*refresh* í† í°ì„ ì‚¬ìš©í•´ì„œ ìƒˆë¡œìš´ í† í°ì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¦¬í”„ë ˆì‰¬ í† í°ì—ë„ ìœ íš¨ ê¸°ê°„ì„ ì„¤ì •*expiration*ì„ í•  ìˆ˜ ìˆì–´ì„œ ê·¸ ì‹œì ê¹Œì§€ ë¬´ì œí•œìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ í† í°ê³¼ ë¦¬í”„ë ˆì‰¬ í† í° ë‘˜ë‹¤ ë‚´ì¥ëœ ë³´ì•ˆ(ì„œëª…ë  ë•Œ)ì„ ê°€ì§€ê³  ìˆì–´ì„œ ë³€ì¡°ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìœ¼ë©° íŠ¹ì • ê¸°ê°„ ë™ì•ˆë§Œ ìœ íš¨í•©ë‹ˆë‹¤.



**onetap : https://www.one-tab.com/page/ghs1fWRKQRWLwzdRuqwI2Q **

- Naver D2 | OAuthì™€ ì¶¤ì„ https://d2.naver.com/helloworld/24942
- tebiva story | OAuth 2.0 â€“ Open API ì¸ì¦ì„ ìœ„í•œ ë§ŒëŠ¥ ë„êµ¬ìƒì https://earlybird.kr/1584
- bubblecode | Understanding OAuth2 http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/
- ì†Œìš©í™˜ì˜ ìƒê°ì €ì¥ì†Œ | OAuth2ì™€ JWT, ì›¹ê¸°ë°˜ SSO ì¸ì¦ https://www.sauru.so/blog/basic-of-oauth2-and-jwt/
- ììœ ë¡œìš´ ì˜¤ë‘ìš°íƒ„ | ì‰½ê²Œ ì•Œì•„ë³´ëŠ” ì„œë²„ ì¸ì¦ 3í¸(SNS ë¡œê·¸ì¸, OAuth 2.0) https://tansfil.tistory.com/60?category=255594
- TOASTMeetup | OAuth 2.0 ëŒ€í‘œ ì·¨ì•½ì ê³¼ ë³´ì•ˆ ê³ ë ¤ ì‚¬í•­ ì•Œì•„ë³´ê¸° https://meetup.toast.com/posts/105

- ì¡°ëŒ€í˜‘ì˜ ë¸”ë¡œê·¸ | OAuth 2.0 ë…¸íŠ¸ https://bcho.tistory.com/942

- victolee | [HTTP/ì¸ì¦] OAuth ì¸ì¦ ë°©ì‹ https://victorydntmd.tistory.com/4

- Yun Blog | OAuth2 ì¸ì¦ ë°©ì‹ ì •ë¦¬ https://cheese10yun.github.io/oauth2/

---



ì›¹ì—ì„œëŠ” 2ê°€ì§€ì˜ ì„ íƒì´ ìˆë‹¤.

- Cookies
- local/session storage.

### local/session storage

ë™ì¼í•œ ë„ë©”ì¸ì˜ JavaScriptë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ XSS(í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…)ê³µê²©ì— ì·¨ì•½í•˜ë‹¤.

### Cookies

ì¿ í‚¤ëŠ” `http-only` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•´ ì•”í˜¸í™”ëœ ì¿ í‚¤ê°€ httpsë¡œë§Œ í†µì‹ í•˜ë„ë¡ ì„¤ì •í•´ XSSì˜ ë¬¸ì œë¥¼ ì™„í™”ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ `CSRF` ê³µê²©ì˜ ìœ„í—˜ì´ ìˆë‹¤.

`CSRF`ëŠ” ìµœê·¼ì— ì¸ì¦ëœ ì‚¬ìš©ìê°€ ì›¹ í”„ë¡œê·¸ë¨ì—ì„œ ì›ì¹˜ ì•ŠëŠ” í–‰ìœ„ë¥¼ í•˜ë„ë¡ í•œë‹¤.

[CSURF](https://github.com/expressjs/csurf) ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì˜ˆë°©í•  ìˆ˜ ìˆë‹¤.

ê·¸ë˜ì„œ ë³´ì•ˆì„ ìœ„í•´ ë³´í†µ Cookie ì‚¬ìš©ì„ ê¶Œì¥í•œë‹¤.



------

### Cookie

- nodejs, expressjs, cookie-parser https://github.com/expressjs/cookie-parser
- wiki cookie ë²ˆì—­ [http://wiki-camp.appspot.com/%5B%EB%B2%88%EC%97%AD%5D_HTTP_Cookie_%28Wikipedia%29?rev=2#h_9c0ac323875ff03e0750c410b3c34433](http://wiki-camp.appspot.com/[ë²ˆì—­]_HTTP_Cookie_(Wikipedia)?rev=2#h_9c0ac323875ff03e0750c410b3c34433)
- ì¿ í‚¤ì™€ ë„ë©”ì¸ì˜ ê´€ê³„ì— ëŒ€í•œ ê°“ê¸€ http://blog.naver.com/PostView.nhn?blogId=gomland&logNo=221492821285&categoryNo=1&parentCategoryNo=0&viewDate=&currentPage=1&postListTopCurrentPage=1&from=postView



1. ì¿ í‚¤ì˜ ì‚¬ìš©
   1. ë°ì´í„° ì €ì¥
   2. ì›¹ í˜ì´ì§€ì˜ ì„¸ì…˜ ìœ ì§€ 
      - REST APIì— requestë¥¼ ë³´ë‚¼ ë•Œ í† í°ì„ ì¸ì¦ í‚¤ë¡œ ì‚¬ìš©í•œë‹¤.
      - html5 ì—ì„œ SessionStorage, LocalStorageê°€ ì§€ì›ë˜ë©´ì„¸ ì„¸ì…˜ ìœ ì§€ë¥¼ ìœ„í•´ ë°˜ë“œì‹œ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ê²Œ ë˜ì—ˆìœ¼ë‚˜..ğŸ™







CookieëŠ” **ì‚¬ìš©ìì˜ ì •ë³´ê°€ ì›¹ ì„œë²„ë¥¼ í†µí•´ ì‚¬ìš©ìì˜ ì»´í“¨í„°ì— ì§ì ‘ ì €ì¥ë˜ëŠ” ì •ë³´ì˜ ë‹¨ìœ„**

 **ê°ê°ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ê°ê°ì˜ hostë³„ë¡œ ì‚¬ìš©ìì˜ ì»´í“¨í„°ì— dbí˜•íƒœë¡œ ì €ì¥ëœ key-valueí˜•ì‹ì˜ ë°ì´í„° ë¬¶ìŒ**

**1.ê°ê°ì˜ ë¸Œë¼ìš°ì €ë³„ë¡œ ì €ì¥ë˜ë©°**

**2.ê°ê°ì˜ host(ì‚¬ì´íŠ¸)ë³„ë¡œ ì €ì¥ë˜ë©°**

**3.dbí˜•íƒœë¡œ(chromeì˜ ê²½ìš° sqlite dbí˜•íƒœ)**

**4.key-valueí˜•íƒœë¡œ ì €ì¥ëœë‹¤.(keyì™€ valueëª¨ë‘ ë¬¸ìì—´ë§Œ ì €ì¥ê°€ëŠ¥, ê¼¼ìˆ˜ì“°ë©´ ê°ì²´ë„ ê°€ëŠ¥í•˜ì§€ë§Œ ë¶ˆê°€ëŠ¥ì´ë¼ ë³´ëŠ”ê²Œ í¸í•¨)**

ë‹¤ë¥¸ url(host, ì‚¬ì´íŠ¸)ì—ì„œ ë§Œë“  ì¿ í‚¤ë¥¼ ë³´ë‚´ì§€ëŠ” ì•ŠëŠ”ë‹¤. ê·¸ê²ƒê¹Œì§€ ë‹¤ë³´ëƒˆìœ¼ë©´ ë°•í„°ì¡Œì„ ê²ƒì´ë‹¤.

ì •í™•íˆ ë§í•˜ë©´ ë‹¤ë¥¸ urlì— ìˆëŠ” ì¿ í‚¤ëŠ” ê±´ë“œë¦´ ìˆ˜ê°€ ì—†ë‹¤. ë³´ì•ˆì •ì±…ìƒ ê·¸ëŸ¬í•˜ë‹¤.

ì´ì œ ì–´ë–¤ ì‚¬ì´íŠ¸ë¥¼ ê°€ë˜ ì¿ í‚¤ë¥¼ ëª½ë•… ë‹´ì•„ì„œ ìš”ì²­ì— ë„˜ê¸°ê²Œ ëœë‹¤.

ê·¸ëŸ¼ ì¿ í‚¤ê°€ ë§ìœ¼ë©´ ë§ì„ìˆ˜ë¡ ìì—°íˆ httpì½œì˜ ë¶€ë‹´ì€ ì¦ê°€í•˜ê²Œ ëœë‹¤.

ê·¸ë˜ì„œ ì¿ í‚¤ëŠ” **ìš©ëŸ‰ ì œí•œ, ì‹œê°„ì œí•œ, ê°¯ìˆ˜ ì œí•œ**ì´ ìˆë‹¤.

ì¿ í‚¤ëŠ” í´ë¼ì´ì–¸íŠ¸ì— ì €ì¥ëœë‹¤. ì„¸ì…˜ì€ ì„œë²„ì— ì €ì¥ëœë‹¤. 



ì‚¬ìš©ìì˜ ì»´í“¨í„°ê°€ í˜„ì¬ ê°€ì§€ê³  ìˆëŠ” ì¿ í‚¤ë¥¼ í™•ì¸ í•˜ëŠ” ë°©ë²•ì€
`req.cookies.[cookie name]` ì…ë‹ˆë‹¤.

ì¿ í‚¤ë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ì€
`res.cookie(â€˜cookie nameâ€™, â€˜cookie valueâ€™, option)`ì…ë‹ˆë‹¤.

`res.cookie()` ë©”ì†Œë“œëŠ” ì¿ í‚¤ì˜ ì˜µì…˜ì„ ì„¤ì • í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- maxAge: ì¿ í‚¤ì˜ ë§Œë£Œ ì‹œê°„ì„ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ ì„¤ì •
- expires: ì¿ í‚¤ì˜ ë§Œë£Œ ì‹œê°„ì„ í‘œì¤€ ì‹œê°„ ìœ¼ë¡œ ì„¤ì •
- path: ì¿ í‚¤ì˜ ê²½ë¡œ (default: /)
- domain: ì¿ í‚¤ì˜ ë„ë©”ì¸ ì´ë¦„ (default: loaded)
- secure: HTTPS í”„ë¡œí† ì½œë§Œ ì¿ í‚¤ ì‚¬ìš© ê°€ëŠ¥
- httpOnly: HTTP í”„ë¡œí† ì½œë§Œ ì¿ í‚¤ ì‚¬ìš© ê°€ëŠ¥
- signed: ì¿ í‚¤ì˜ ì„œëª… ì—¬ë¶€ë¥¼ ê²°ì •

> ì¿ í‚¤ì˜ ì˜µì…˜ì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì€ `res.cookie()`ì˜ option ë¶€ë¶„ì— ë„£ì–´ì£¼ë©´
> ë©ë‹ˆë‹¤.



- ì¿ í‚¤ì˜ ì†ì„± ë° ì¿ í‚¤ì˜ ì¢…ë¥˜

https://meetup.toast.com/posts/172





+ ì‚¬ìš©ìê°€ íŠ¹ì • ì‚¬ì´íŠ¸ì— ì¬ì ‘ì† í–ˆë‹¤ëŠ” ê±¸ ì–´ë–»ê²Œ ì•Œê¹Œ? -> ì¿ í‚¤ (git/ë°±ì¤€)
+ set-cookie, expires -> ë¸Œë¼ìš°ì €ì—ì„œ ì¿ í‚¤ë¥¼ ì €ì¥í•˜ë„ë¡ ì„¤ì •ì´ ë˜ì–´ìˆìœ¼ë©´ ë¸Œë¼ìš°ì €ëŠ” ë§Œë£Œì¼ê¹Œì§€ ê·¸ëŸ¬í•œ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆìŒ. ì‚¬ìš©ìê°€ ì¿ í‚¤ì— ì„¤ì •ëœ ê²½ë¡œë¡œ ì ‘ì†í•˜ê²Œ ë˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ì„œë²„ë¡œ ê·¸ ì¿ í‚¤ë¥¼ ì¬ì „ì†¡ í•œë‹¤. 





## Session

Sessionì´ë€?

ì„¸ì…˜ì€ **ì¿ í‚¤ë³´ë‹¤ ë” ì•ˆì „í•˜ê³  ë§ì€ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì €ì¥ ë°©ì‹** ì…ë‹ˆë‹¤. ì¿ í‚¤ì˜ ê²½ìš° ë°ì´í„°ë¥¼ ì‚¬ìš©ìì˜ ì»´í“¨í„°ì— ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ë¹„ë°€ë²ˆí˜¸ ê°™ì€ ë¯¼ê°í•œ ë¶€ë¶„ì´ë¼ë„ ì˜ˆì™¸ì—†ì´ ê·¸ëŒ€ë¡œ ë“œëŸ¬ë‚©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì„¸ì…˜ì€ **ë°ì´í„°ë¥¼ ì„œë²„ì— ì €ì¥í•˜ê¸° ë•Œë¬¸ì—** ì¿ í‚¤ë³´ë‹¤ ì•ˆì „í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.



### ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ ë°©ì‹

ì˜›ë‚ ì— í† í° ê¸°ë°˜ ì¸ì¦ì´ ì—†ì—ˆì„ ë•Œ ì„œë²„ ì„¸ì…˜ì„ ì‚¬ìš©í•´ ì¸ì¦ì„ í–ˆë‹¤.

1. í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œê·¸ì¸
2. ì„±ê³µí•˜ë©´ ì„œë²„ê°€ ìœ ì € ì„¸ì…˜ì„ ë§Œë“¤ê³  ë©”ëª¨ë¦¬ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•œë‹¤.
3. ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì„¸ì…˜ IDë¥¼ ë³´ë‚¸ë‹¤.
4. í´ë¼ì´ì–¸íŠ¸ì˜ ë¸Œë¼ìš°ì €ì— ì„¸ì…˜ì˜ IDë§Œ ì¿ í‚¤ì— ì €ì¥í•˜ê²Œ í•œë‹¤.

ì„¸ì…˜ ë°ì´í„°ê°€ ì„œë²„ì˜ ë©”ëª¨ë¦¬ì— ì €ì¥ë˜ë¯€ë¡œ, í™•ì¥ ì‹œ ëª¨ë“  ì„œë²„ê°€ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë³„ë„ì˜ ì¤‘ì•™ ì„¸ì…˜ ê´€ë¦¬ ì‹œìŠ¤í…œì´ í•„ìš”í•˜ë‹¤.



#### ë‹¨ì 

- ì¤‘ì•™ ì„¸ì…˜ ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì—†ìœ¼ë©´, ì‹œìŠ¤í…œ í™•ì¥ì— ì–´ë ¤ì›€ì´ ìƒê¸´ë‹¤.
- ì¤‘ì•™ ì„¸ì…˜ ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì¥ì• ê°€ ì¼ì–´ë‚˜ë©´, ì‹œìŠ¤í…œ ì „ì²´ê°€ ë¬¸ì œê°€ ìƒê¸´ë‹¤.
- ë§Œì•½ ë©”ëª¨ë¦¬ì— ì„¸ì…˜ ì •ë³´ê°€ ë“¤ì–´ìˆë‹¤ë©´, ë©”ëª¨ë¦¬ê°€ ë§ì´ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤.

ê·œëª¨ í™•ì¥ì´ í•„ìš”ì—†ëŠ” ì†Œê·œëª¨ í”„ë¡œê·¸ë¨ ì‘ì„±ì—ì„œëŠ” ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•´ë„ ìƒê´€ ì—†ì„ ê²ƒì´ë‹¤



-------

### Session Storage (Web Storage)

https://en.wikipedia.org/wiki/Web_storage

- Cookies are intended for communication with server; they are automatically added to all requests and can be accessed by both the server and client side. 

https://www.zerocho.com/category/HTML&DOM/post/5918515b1ed39f00182d3048

ë¡œì»¬ìŠ¤í† ë¦¬ì§€, ì„¸ì…˜ìŠ¤í† ë¦¬ì§€ ê·¸ë¦¬ê³  ì¿ í‚¤

ì´ê²Œ ë¬¸ì œê°€ ë˜ê¸°ë„ í•©ë‹ˆë‹¤. ë§Œì•½ 4kb ìš©ëŸ‰ ì œí•œì„ ê±°ì˜ ë‹¤ ì±„ìš´ ì¿ í‚¤ê°€ ìˆë‹¤ë©´, ìš”ì²­ì„ í•  ë•Œë§ˆë‹¤ ê¸°ë³¸ 4kbì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. 4kb ì¤‘ì—ëŠ” ì„œë²„ì— í•„ìš”í•˜ì§€ ì•Šì€ ë°ì´í„°ë“¤ë„ ìˆê² ì£ . ë°ì´í„° ë‚­ë¹„ê°€ ë°œìƒí•˜ëŠ” ê²ë‹ˆë‹¤. ë°”ë¡œ ê·¸ëŸ° ë°ì´í„°ë“¤ì„ ì´ì œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì™€ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë‘ ì €ì¥ì†Œì˜ ë°ì´í„°ëŠ” ì„œë²„ë¡œ ìë™ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.



- **localStorage** - ë¡œì»¬ì— ë„ë©”ì¸ ë³„ë¡œ ì§€ì†ë˜ëŠ” storage

  **sessionStorage** - ì„¸ì…˜ì´(í”„ë¡œì„¸ìŠ¤, íƒ­, ë¸Œë¼ìš°ì €) ì¢…ë£Œë  ë•Œê¹Œì§€ ì§€ì†ë˜ëŠ” storage

ë³´í†µ ì„¸ì…˜ì˜ ì¢…ë£ŒëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë¸Œë¼ìš°ì €ì˜ ì¢…ë£Œë¥¼ ëœ»í•œë‹¤.

 sessionStorageì—ì„œ ì˜ë¯¸í•˜ëŠ” ì„¸ì…˜ì€ ê°€ì¥ ì‘ì€ ë‹¨ìœ„ì¸ íƒ­ë‹¨ìœ„ë¥¼ ì˜ë¯¸í•œë‹¤.



**íƒ­ë§ˆë‹¤ sessionStorageëŠ” ë”°ë¡œ ë°°ì •ë˜ë©° ì„œë¡œì˜ ì˜ì—­ì„ ê³µìœ í•˜ì§€ ì•ŠëŠ”ë‹¤.**

**ë”°ë¼ì„œ ê°’ì„ ì¹¨ë²”í•  ìˆ˜ ë„ ì—†ë‹¤.**





## ê²°ë¡  ë° êµ¬í˜„

ì¿ í‚¤ì— ë‹´ì! (í”„ë¡ íŠ¸ëŠ”? -> ì•ˆ í•´ë„ ëœë‹¤! ì¢‹ë„¤!) -> ìŠ¬í””ì˜ ì‹œì‘



ì´ë²ˆì—ëŠ” node.jsì—ì„œ cookieë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. 

cookieë¥¼ ê·¸ëƒ¥ ì‚¬ìš©í•˜ë©´ ë³´ì•ˆì— ì·¨ì•½í•˜ë¯€ë¡œ ì•”í˜¸í™”ëœ cookieë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. 

 

#### Cookie ì‚¬ìš©ì„ ìœ„í•œ ì„¤ì •

#### Cookie-parser ëª¨ë“ˆ ì„¤ì¹˜

Express í”„ë ˆì„ì›Œí¬ì€ cookie-parserë¼ëŠ” ëª¨ë“ˆì„ í†µí•´ cookieë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. 

```
npm install cookie-parser --save
```



#### web.js ì„¤ì •

express í”„ë ˆì„ì›Œí¬ì—ì„œ cookie parserë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ web.jsì— ì„¤ì •í•©ë‹ˆë‹¤. 

cookieParser(secret, options) ì—ì„œ ì²«ë²ˆì§¸ ì¸ìì¸ secretì€ ì¿ í‚¤ ì„œëª…ì— ì‚¬ìš©ë˜ëŠ” ë¬¸ìì—´ ë˜ëŠ” ë°°ì—´ì„ ì˜ë¯¸(ì„ íƒì‚¬í•­)í•˜ê³ , ë‘ë²ˆì§¸ ì¸ì optionsëŠ” ì¿ í‚¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” optionì„ ì˜ë¯¸í•˜ë©° ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤.  



#### cookieì— ê°’ ì„¸íŒ…

res.cookie(name, value, options) í•¨ìˆ˜ë¥¼ í†µí•´ ì‘ë‹µ í—¤ë”ì— ì¿ í‚¤ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```
router.get('/login', function (req, res) {
	... 
	var expiryDate = new Date( Date.now() + 60 * 60 * 1000 * 24 * 7); // 24 hour 7ì¼

	res.cookie('loginObj', loginObj, { expires: expiryDate, httpOnly: true, signed:true });
    ...
}    
```

ìì£¼ ì‚¬ìš©í•˜ëŠ” Options

expires ëŠ” ì „ì†¡ëœ ì¿ í‚¤ì˜ ë³´ì¦ê¸°ê°„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. (ì„ì˜ë¡œ ì¿ í‚¤ë¥¼ ì‚­ì œí•˜ì§€ ì•ŠëŠ” í•œ ë¸Œë¼ìš°ì €ë¥¼ ì¢…ë£Œí•˜ë”ë¼ë„ ë³´ì¦ê¸°ê°„ê¹Œì§€ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ)

httpOnly ëŠ” ì›¹ì„œë²„ì—ì„œë§Œ ì¿ í‚¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í”Œë˜ê·¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. (ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì„ì˜ë¡œ cookieì— ì ‘ì†í•˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ trueë¡œ ì„¤ì •)

signed : ì„œëª…(ì•”í˜¸í™”)ëœ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

 

#### cookie ê°’ ì‚¬ìš©

ì•”í˜¸í™”ëœ ì¿ í‚¤ì˜ ê²½ìš°ëŠ” 'req.signedCookies.ë³€ìˆ˜ëª…'ì„ ì´ìš©í•´ì„œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. 

ì¼ë°˜ ì¿ í‚¤ì˜ ê²½ìš°ëŠ” 'req.cookies.ë³€ìˆ˜ëª…'ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. 

```
router.get('/login', function (req, res) {
  ...
  var cookieLoginObj = req.signedCookies.loginObj; //ì•”í˜¸í™”ëœ ì¿ í‚¤
  
  var cookieLoginObj = req.cookies.testKey;	//í‰ë¬¸ ì¿ í‚¤
  ...
});
```

 

 

 

#### ë¡œê·¸ì¸ ì²˜ë¦¬

ì´ì „ì— ì•Œì•„ë³¸ ë„¤ì´ë²„ë°´ë“œ ë¡œê·¸ì¸ APIë¥¼ ì´ìš©í•´ì„œ ì •ìƒì ìœ¼ë¡œ ë¡œê·¸ì¸í•œ ê²½ìš° ì•”í˜¸í™”ëœ ì¿ í‚¤ë¥¼ ì €ì¥í•´ì„œ ë¡œê·¸ì¸ ì²˜ë¦¬ í•©ë‹ˆë‹¤.  (ë°˜ë“œì‹œ ì•”í˜¸í™”ëœ ì¿ í‚¤ ì‚¬ìš©í•´ì•¼í•˜ë©°, ë¹„ë°€ë²ˆí˜¸ ë“± ë¯¼ê°í•œ ê°œì¸ì •ë³´ë¥¼ ì €ì¥í•˜ë©´ ì•ˆë¨)

[2019/04/02 - [Node.js\] - [Node.js] ì™¸ë¶€ì„œë¹„ìŠ¤ API(ë„¤ì´ë²„ë°´ë“œ) ì ìš©í•˜ê¸°](https://junspapa-itdev.tistory.com/11)



 

```
router.get('/login', function (req, res) {
	... 
	var expiryDate = new Date( Date.now() + 60 * 60 * 1000 * 24 * 7); // 24 hour 7ì¼

	res.cookie('loginObj', loginObj, { expires: expiryDate, httpOnly: true, signed:true });
    ...
}    
```

 

ê·¸ë¦¬ê³  ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì²´í¬í•©ë‹ˆë‹¤. 

```
router.get('/', function(req, res) {

  var cookieLoginObj = req.signedCookies.loginObj;
  
  if(cookieLoginObj && cookieLoginObj.mberSn !== ''){
    ..ë¡œê·¸ì¸í•œ ê²½ìš° ì²˜ë¦¬..
  }else{
  	..ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ì²˜ë¦¬..
  }
});
```

 

 

#### ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬

res.clearCookie(ì¿ í‚¤ëª…)ì„ ì´ìš©í•©ë‹ˆë‹¤. 

```
router.get('/logout', function (req, res) {
	res.clearCookie("loginObj");	
	res.redirect("/");
});
```

 



## cors

http://guswnsxodlf.github.io/enable-CORS-on-express

### CORSë€ ë¬´ì—‡ì¸ê°€

- Using CORS https://www.html5rocks.com/en/tutorials/cors/#toc-resources
- HTTP ì ‘ê·¼ ì œì–´ (CORS) https://developer.mozilla.org/ko/docs/Web/HTTP/Access_control_CORS



CORSë€ Cross Origin Resource Sharingì˜ ì•½ìë¡œ, **í˜„ì¬ ë„ë©”ì¸ê³¼ ë‹¤ë¥¸ ë„ë©”ì¸ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ê°€ ìš”ì²­ë  ê²½ìš°ë¥¼ ë§í•œë‹¤.** ì˜ˆë¥¼ ë“¤ì–´, ë„ë©”ì¸ **http://A.com** ì—ì„œ ì½ì–´ì˜¨ HTMLí˜ì´ì§€ì—ì„œ ë‹¤ë¥¸ ë„ë©”ì¸ **http://B.com/image.jpg**ë¥¼ ìš”ì²­í•˜ëŠ” ê²½ìš°ë¥¼ ë§í•œë‹¤. ì´ëŸ° ê²½ìš°ì— í•´ë‹¹ ë¦¬ì†ŒìŠ¤ëŠ” cross-origin HTTP ìš”ì²­ì— ì˜í•´ ìš”ì²­ëœë‹¤. **ë³´ì•ˆ ìƒì˜ ì´ìœ ë¡œ, ë¸Œë¼ìš°ì €ëŠ” CORSë¥¼ ì œí•œí•˜ê³  ìˆë‹¤.**

í•˜ì§€ë§Œ SPA(Single Page Application)ì˜ ê²½ìš°ì—ëŠ”, RESTful APIë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¹„ë™ê¸° ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í•˜ê¸° ë•Œë¬¸ì— API ì„œë²„ì™€ ì›¹ í˜ì´ì§€ ì„œë²„ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤. ì´ëŸ° ê²½ìš°ì— API ì„œë²„ë¡œ ìš”ì²­ì„ í•  ì‹œì— CORS ì œí•œì´ ê±¸ë¦¬ê²Œ ëœë‹¤.

-> Expressì—ì„œ CORS í—ˆìš©í•˜ê¸°

but... ì´ê±° ë§Œìœ¼ë¡œëŠ” ì•ˆ ëœë‹¤..

- ### Simple Usage (Enable *All* CORS Requests) 

  - simple. all ì´ë¼ì„œ ë¬¸ì œì˜€ë‹¤.....

- express cors library https://github.com/expressjs/cors

  - configuration Options
  - `credentials`: Configures the **Access-Control-Allow-Credentials** CORS header. Set to `true` to pass the header, otherwise it is omitted.

     

- A [request](https://fetch.spec.whatwg.org/#concept-request) has an associated credentials mode, which is "`omit`", "`same-origin`", or "`include`". Unless stated otherwise, it is "`omit`". https://fetch.spec.whatwg.org/#concept-request-credentials-mode

- Using fetch Fetchì˜_ì‚¬ìš©ë²•#ìê²©_ì¦ëª…(credentials)ì´_í¬í•¨ëœ_Request_ìš”ì²­[https://developer.mozilla.org/ko/docs/Web/API/Fetch_API/Fetch%EC%9D%98_%EC%82%AC%EC%9A%A9%EB%B2%95#%EC%9E%90%EA%B2%A9_%EC%A6%9D%EB%AA%85(credentials)%EC%9D%B4_%ED%8F%AC%ED%95%A8%EB%90%9C_Request_%EC%9A%94%EC%B2%AD](https://developer.mozilla.org/ko/docs/Web/API/Fetch_API/Fetchì˜_ì‚¬ìš©ë²•#ìê²©_ì¦ëª…(credentials)ì´_í¬í•¨ëœ_Request_ìš”ì²­)

ë³´í†µ `fetch`ëŠ” **ì¿ í‚¤ë¥¼ ë³´ë‚´ê±°ë‚˜ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.**  ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©ì ì„¸ì…˜ì„ ìœ ì§€ ê´€ë¦¬í•´ì•¼í•˜ëŠ” ê²½ìš° ì¸ì¦ë˜ì§€ ì•ŠëŠ” ìš”ì²­ì´ ë°œìƒí•©ë‹ˆë‹¤. ì¿ í‚¤ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•´ì„œëŠ” ìê²©ì¦ëª…(credentials) ì˜µì…˜ì„ ë°˜ë“œì‹œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
[2017ë…„ 8ì›” 25ì¼](https://github.com/whatwg/fetch/pull/585) ì´í›„. ê¸°ë³¸ ìê²©ì¦ëª…(credentials) ì •ì±…ì´ `same-origin` ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. íŒŒì´ì–´í­ìŠ¤ëŠ” 61.0b13 ì´í›„ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.



ê°œë°œìë¥¼ ìœ„í•œ ì›¹ ê¸°ìˆ  https://developer.mozilla.org/ko/docs/Web

ì›¹(World Wide Web)ì˜ ê°œë°©ì„±ì€ ì›¹ì‚¬ì´íŠ¸ë‚˜ ì˜¨ë¼ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì œì‘í•˜ë ¤ëŠ” ì‚¬ëŒë“¤ì—ê²Œ ë§ì€ ê¸°íšŒë¥¼ ì œê³µí•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ ì‚¬ìš© ë°©ë²•ì„ ì•Œì•„ì•¼ ì›¹ ê¸°ìˆ ì„ ì˜ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 



ì•Œì•„ì•¼ ì¨ë¨¹ëŠ”ë° ëª¨ë¥´ê³ .. ë­ê°€ ì¤‘ìš”í•œì§€ ëª¨ë¥´ê³ .. ì–´ë–»ê²Œ ê²€ìƒ‰í•´ì•¼ í•˜ëŠ”ì§€ ìš”ë ¹ì„ ëª¨ë¥¸ë‹¤....



domain ë¬¸ì œë¼ëŠ”ê±¸ ê²€ìƒ‰í•˜ë‹¤ê°€ ì–¸ëœ»ì–¸ëœ» ë³´ê¸´ í–ˆëŠ”ë° ê·¸ê²Œ ë¬´ìŠ¨ ëœ»ì¸ì§€ ì„¤ëª…ì´ ì—†ì—ˆê³ ...

ê±°ì˜ í¬ê¸°í–ˆì„ ë•Œ ì¦ˆìŒ êµìˆ˜ë‹˜ê»˜ ì§ˆë¬¸í–ˆëŠ”ë° ë„ë©”ì¸ ë¬¸ì œ ì•„ë‹ê¹Œìš”? í•˜ì…¨ë‹¤

corsë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì¼ë‹¨ ë•œë¹µí•˜ëŠ”ê²Œ ì•„ë‹ˆì—ˆë‹¤ë©´.. ë” ì¼ì° í–‰ë³µí–ˆì„ê¹Œ...





## 1. headerê°’ì— Access-Control-Allow-Credentialsë¥¼ trueë¡œ ...

**Access-Control-Allow-Origin**ë„ ***** ê¸°í˜¸ê°€ ì•„ë‹Œ **ë„ë©”ì¸(http://localhost:3000)**ì„ ëª…ì‹œí•´ ì£¼ì–´ì•¼ í•œë‹¤ê³  í•œë‹¤.

```javascript
app.all('/*', function(req, res, next) {
  res.header('Access-Control-Allow-Origin', 'http://localhost:3000');
  res.header('Access-Control-Allow-Methods', 'POST, PUT, GET, DELETE');
  res.header('Access-Control-Allow-Headers', 'X-Requested-With, Content-Type');
  res.header('Access-Control-Allow-Credentials', true);
  next();
});
```

## 2. XMLHttpRequest ì˜µì…˜ì— credentials ê°’ì„ trueë¡œ

**axiox** ëª¨ë“ˆì—ëŠ” **withCredentials**ë¼ëŠ” ì˜µì…˜ì´ ìˆë‹¤. ì¼ë°˜ **ajax**ë‚˜ **XMLHttpRequest**ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ ê·¸ì— ë§ëŠ” ì˜µì…˜ ì‚¬í•­ ë“¤ì´ ìˆì„ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

```javascript
export const instanceWithCredential = axios.create({
  baseURL: 'http://localhost:3102/',
  timeout: 180000,
  withCredentials: true
})
...
const url = '/api/v1.0/auth/session';
axiosInstance({
    method: 'get',
    url
}).then(response => {
    // Do Stuff
}).catch(error => {
    // Do Stuff
});
```







```
// const express = require('express');
// const { isLoggedIn, isNotLoggedIn } = require('./auth/middlewares');
//
// const router = express.Router();
//
// router.get('/connect', (req, res, next) => {
//   try {
//     if (req.signedCookies['haveCookie']) {
//       console.log('------------------------------YOU ARE HERE---------------------------');
//       console.log('cookies: ', req.cookies);
//       console.log('signed cookies: ', req.signedCookies);
//       res.status(200).json({
//         message: 'Test is over. you got the cookie and sent it',
//       });
//     } else {
//       const test_cookie = 'ì¿ í‚¤ëƒ ëƒ ';
//       res.cookie('haveCookie', test_cookie, {
//         // expires: new Date(Date.now() + 40000),
//         // domain: 'c0d5b39e.ngrok.io',
//         httpOnly: true,
//         signed: true,
//       });
//       res.status(200).json({
//         code: 200,
//         name: 'hello there'
//       });
//     }
//   } catch (error) {
//     console.error(error);
//     return next(error);
//   }
// });
//
// module.exports = router;
```





# ê¸°íƒ€

- ì„œëª…ëœ ì¿ í‚¤ì˜ ì•…ìš© ë°©ì§€

https://docs.aws.amazon.com/ko_kr/AmazonCloudFront/latest/DeveloperGuide/private-content-signed-cookies.html#private-content-how-signed-cookies-work

`Domain` í—¤ë”ì— `Set-Cookie` íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì •í•  ë•ŒëŠ” ë£¨íŠ¸ ë„ë©”ì¸ ì´ë¦„ì„ ê°€ì§„ ì‚¬ëŒì´ ì•¡ì„¸ìŠ¤í•˜ì§€ ëª»í•˜ë„ë¡ ìµœëŒ€í•œ ì •í™•í•œ ê°’ì„ ì§€ì •í•˜ì„¸ìš”. ì˜ˆë¥¼ ë“¤ìë©´ example.comë³´ë‹¤ apex.example.comì´ ë” ì¢‹ê³ , example.comì„ ì œì–´í•˜ì§€ ì•Šì„ ë•ŒëŠ” íŠ¹íˆ ê·¸ë ‡ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ nadir.example.comì„ í†µí•œ ì½˜í…ì¸  ì•¡ì„¸ìŠ¤ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ° ìœ í˜•ì˜ ê³µê²©ì„ ë°©ì§€í•˜ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•˜ì‹­ì‹œì˜¤.

- `Expires` ë° `Max-Age` ì¿ í‚¤ ì†ì„±ì„ ì œì™¸í•˜ì—¬ `Set-Cookie` í—¤ë”ì—ì„œ ì„¸ì…˜ ì¿ í‚¤ë¥¼ ë§Œë“¤ë„ë¡ í•©ë‹ˆë‹¤. ì„¸ì…˜ ì¿ í‚¤ëŠ” ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì„ ë•Œ ìë™ìœ¼ë¡œ ì‚­ì œë˜ë©°, ë”°ë¼ì„œ ê¶Œí•œ ì—†ëŠ” ì œ3ìê°€ ì½˜í…ì¸ ì— ì•¡ì„¸ìŠ¤í•  ê°€ëŠ¥ì„±ì„ ì¤„ì—¬ ì¤ë‹ˆë‹¤.
- `Secure` ì†ì„±ì„ í¬í•¨í•˜ì—¬ ìµœì¢… ì‚¬ìš©ìê°€ ì´ë¥¼ ìš”ì²­í•  ë•Œ ì¿ í‚¤ê°€ ì•”í˜¸í™”ë˜ë„ë¡ í•˜ì„¸ìš”.
- ê°€ëŠ¥í•˜ë©´ ì‚¬ìš©ì ì§€ì • ì •ì±…ì„ ì‚¬ìš©í•˜ê³  ìµœì¢… ì‚¬ìš©ìì˜ IP ì£¼ì†Œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- `CloudFront-Expires` ì†ì„±ì—ì„œ ì‚¬ìš©ìì˜ ì½˜í…ì¸  ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•  ê¸°ê°„ì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ì—¬ ê°€ì¥ ì§§ê³  í•©ë¦¬ì ì¸ ë§Œë£Œ ì‹œê°„ì„ ì§€ì •í•˜ì„¸ìš”.



- ì™¸ë¶€ API ë¡œê·¸ì¸ ì ìš© (ë„¤ì´ë²„)

https://junspapa-itdev.tistory.com/11





- postman cookie setting 

  - https://learning.getpostman.com/docs/postman/sending-api-requests/cookies/

  

- AJAX, XMLHttpRequestì™€ Fetch ì‚´í´ë³´ê¸°
- **ì´ í¬ìŠ¤íŠ¸ëŠ” AJAXì˜ ëŒ€í‘œì ì¸ APIì¸ XMLHttpRequestì™€ Fetchì˜ ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•ê³¼ ì†ì„±ë“¤ì„ ì‚´í´ë´…ë‹ˆë‹¤.** ê¸°ì¡´ì˜ XHR ê°ì²´ë¥¼ ì´ìš©í•œ AJAXëŠ” ë³µì¡í•˜ê¸°ë„ í•˜ë©° ê°€ë…ì„±ì´ ë–¨ì–´ì¡Œì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë“±ì¥í•œ ê²ƒì´ Fetch APIë¡œ ES6(ES2015)ì—ì„œ í‘œì¤€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. FetchëŠ” ë°˜í™˜ê°’ìœ¼ë¡œ Promiseë¥¼ ê°€ì§‘ë‹ˆë‹¤.
  
  - https://junhobaik.github.io/ajax-xhr-fetch/



## need check

 'secure'ë§¤ê°œ ë³€ìˆ˜ê°€ í•­ìƒ TRUEë¡œ ì„¤ì •ë˜ê³  ìˆìŒì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤.

Httpsë¡œ localhostë¥¼ ë°©ë¬¸í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ë¸Œë¼ìš°ì €ëŠ” ì¿ í‚¤ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ $ _SERVER [ 'HTTP_Host']ë¥¼ ê¸°ë°˜ìœ¼ë¡œ 'localhost'ì—¬ë¶€ì— ë”°ë¼ 'ë³´ì•ˆ'ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì¡°ê±´ë¶€ë¡œ ì„¤ì •í•˜ë„ë¡ ì½”ë“œì˜ í•´ë‹¹ ë¶€ë¶„ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆ ì˜ ì‘ë™í•©ë‹ˆë‹¤.



- `methods`: Configures the **Access-Control-Allow-Methods** CORS header. Expects a comma-delimited string (ex: 'GET,PUT,POST') or an array (ex: `['GET', 'PUT', 'POST']`). ì—¬ê¸° ì˜ ëª¨ë¥´ê² ë”°





ì™„ì „ ê¸°íƒ€

- defining statics function (like in mongoose) in mySql using sequelize
  - https://stackoverflow.com/questions/43451362/defining-statics-function-like-in-mongoose-in-mysql-using-sequelize/43518383





same site blah

- ë°±ì¤€

A cookie associated with a cross-site resource at <URL> was set without the `SameSite` attribute. A future release of Chrome will only deliver cookies with cross-site requests if they are set with `SameSite=None` and `Secure`. You can review cookies in developer tools under Application>Storage>Cookies and see more details at <URL> and <URL>.